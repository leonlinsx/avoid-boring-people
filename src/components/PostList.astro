---
// PostList.astro
import PostCard from './PostCard.astro';
import { enrichPost } from '../utils/text';
import type { CollectionEntry } from 'astro:content';
import type { BlogPost } from '../utils/text';

interface Props {
  posts: (CollectionEntry<'blog'> | BlogPost)[];
  variant?: 'list' | 'grid' | 'compact';
}

const { posts = [], variant = 'list' } = Astro.props;
const enrichedPosts: BlogPost[] = posts.map((p) => enrichPost(p as any));
---

<section class:list={['writing-post-list', variant]}>
  {enrichedPosts.map((post) => <PostCard post={post} />)}
</section>

<style>
  .writing-post-list {
    display: flex;
    flex-direction: column;
    width: 100%;
    margin: 0;
    padding: 0;
  }

  /* Compact variant (for Related Posts) */
  .writing-post-list.compact {
    gap: 0; /* let post-card handle vertical rhythm */
  }

  .writing-post-list.compact :global(.post-card) {
    align-items: flex-start;
    padding-bottom: var(--space-sm); /* space before divider */
    margin-bottom: var(--space-md); /* space after divider */
    border-bottom: 1px solid var(--color-border-soft);
  }

  .writing-post-list.compact :global(.post-card:last-child) {
    border-bottom: none;
    margin-bottom: 0; /* no trailing gap */
  }

  .writing-post-list.compact :global(.post-title) {
    margin: 0 0 var(--space-xs) 0; /* tighter title → summary */
    line-height: 1.3; /* matches heading style */
    font-size: var(--text-lg);
    font-weight: 600;
  }

  .writing-post-list.compact :global(.post-summary) {
    margin-top: 0;
    margin-bottom: var(--space-xs); /* tighter summary → meta */
  }

  .writing-post-list.compact :global(.post-meta) {
    margin-top: 0;
  }

  .writing-post-list.compact :global(.post-thumb) {
    margin: var(--space-xs); /* reset any inherited vertical margins */
    display: block;
  }

  /* Grid unchanged */
  .writing-post-list.grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: var(--space-lg);
  }
</style>
