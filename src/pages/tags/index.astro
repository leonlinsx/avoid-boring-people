---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { SITE_TITLE } from '../../consts';

const posts = await getCollection('blog');

// Collect all tags with counts
const tagCounts = new Map<string, number>();
for (const post of posts) {
  for (const tag of post.data.tags || []) {
    const key = tag.toLowerCase();
    tagCounts.set(key, (tagCounts.get(key) || 0) + 1);
  }
}

// Convert to sorted array
const tags = Array.from(tagCounts.entries()).sort((a, b) =>
  a[0].localeCompare(b[0]),
);
---

<BaseLayout
  title={`Tags | ${SITE_TITLE}`}
  description="Browse all tags used in the blog."
>
  <h1>All Tags</h1>
  <ul class="tag-list">
    {
      tags.map(([tag, count]) => (
        <li>
          <a href={`/tags/${encodeURIComponent(tag)}/`}>
            {tag} ({count})
          </a>
        </li>
      ))
    }
  </ul>
</BaseLayout>

<style>
  .tag-list {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-sm);
    margin-top: var(--space-md);
    padding: 0;
    list-style: none;
  }
  .tag-list li a {
    display: inline-block;
    padding: 0.35rem 0.75rem;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-pill);
    font-size: var(--text-base-sm);
    color: var(--color-text);
    text-decoration: none;
    transition:
      background 0.2s,
      color 0.2s,
      border-color 0.2s;
  }
  .tag-list li a:hover {
    background: var(--color-border);
    border-color: var(--color-link);
    color: var(--color-link);
  }
</style>
