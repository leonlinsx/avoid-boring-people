---
import BaseLayout from "../layouts/BaseLayout.astro";
import PostCard from "../components/PostCard.astro";
import { getCollection } from "astro:content";
import readingTime from "reading-time";

// Load posts from content collection
const allPosts = await getCollection("blog");

// Add readingTime and sort newest first, then limit to 3
const posts = allPosts
  .map((p) => ({
    ...p,
    data: {
      ...p.data,
      readingTime: Math.max(
        1,
        Math.round(readingTime(p.body ?? "").minutes)
      ),
    },
  }))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);
---

<BaseLayout title="Home">
  <section class="hero">
    <h1>
      I write to think clearly about finance, tech, and ideas that interest me
    </h1>
    <p>
      Sharing my writing helps my ideas compound and helps me connect with other
      curious people.
    </p>
    <p><a href="/newsletter">Join 5000+ readers →</a></p>
    <p><a href="/best-of">New here? Start here →</a></p>
  </section>

  <section class="latest-posts">
    <h2>Latest Posts</h2>
    {posts.map((post) => <PostCard post={post} />)}
  </section>

  <!-- About teaser -->
  <section class="about-teaser">
    <p>
      I've worked in investing, investment banking, big tech, and startups, and
      now I write to make sense of it all.
      <a href="/about">Read more →</a>
    </p>
  </section>

  <!-- As featured in -->
  <section class="featured">
    <h3>As featured in</h3>
    <div class="logos">
      <img src="/logos/sample1.png" alt="Publication 1" />
      <img src="/logos/sample2.png" alt="Publication 2" />
    </div>
  </section>

  <!-- Contact CTA -->
  <section class="contact-cta">
    <p>
      I consult and angel invest selectively.
      <a href="/about#contact">Get in touch →</a>
    </p>
  </section>
</BaseLayout>

<style>
  .hero {
    margin-bottom: 2.5rem;
    text-align: center;
  }

  .latest-posts {
    margin-top: 2rem;
  }

  .about-teaser,
  .contact-cta {
    margin-top: 2.5rem;
    padding: 1rem;
    background: var(--color-quote);
    border-radius: 8px;
  }

  .featured {
    margin-top: 2.5rem;
    text-align: center;
  }

  .featured .logos {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 1.25rem;
    margin-top: 1rem;
  }

  .featured img {
    height: 32px;
    max-width: 150px;
    object-fit: contain;
    filter: grayscale(100%);
    opacity: 0.85;
    transition: opacity 0.2s;
  }

  .featured img:hover {
    opacity: 1;
  }

  @media (min-width: 768px) {
    .featured img {
      height: 36px;
    }
  }
</style>
